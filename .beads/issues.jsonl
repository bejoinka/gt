{"id":"icecream-0g4","title":"Test hash ID","status":"tombstone","priority":3,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-14T23:00:24.533397-05:00","created_by":"JB","updated_at":"2026-01-14T23:00:33.781348-05:00","deleted_at":"2026-01-14T23:00:33.781348-05:00","deleted_by":"JB","delete_reason":"delete","original_type":"task"}
{"id":"icecream-1","title":"Game Foundation Epic","description":"Set up the core Next.js application with Turbo, Redis session management, and foundational game state architecture.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:15:07.330628-05:00","closed_at":"2026-01-14T23:15:07.330628-05:00","close_reason":"All foundation tasks complete: Next.js app, Redis session, game state schema"}
{"id":"icecream-10","title":"Core Game Systems Epic","description":"Implement the layered pulse system (Global → City → Neighborhood → Family) with drift mechanics, event triggers, and cross-layer propagation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:15:07.444631-05:00","closed_at":"2026-01-14T23:15:07.444631-05:00","close_reason":"All core systems complete: Global/City/Neighborhood/Family pulse, events, cross-layer propagation"}
{"id":"icecream-11","title":"Implement Global pulse system","description":"Implement GlobalPulse with enforcementClimate, mediaNarrative, judicialAlignment, politicalVolatility. Update every 14-28 turns. Create GlobalEvent triggers.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:12:40.801432-05:00","closed_at":"2026-01-14T23:12:40.801432-05:00","close_reason":"Implemented updateGlobalPulse with volatility-based drift, shouldUpdateGlobalPulse for 14-28 turn cadence"}
{"id":"icecream-12","title":"Implement City pulse system","description":"Implement CityPulse with federalCooperation, dataDensity, politicalCover, civilSocietyCapacity, bureaucraticInertia. Update every 7 turns. Handle CityEvents.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:12:40.908427-05:00","closed_at":"2026-01-14T23:12:40.908427-05:00","close_reason":"Implemented updateCityPulse with global pressure propagation, weekly update cadence"}
{"id":"icecream-13","title":"Implement Neighborhood pulse system","description":"Implement NeighborhoodPulse with trust, suspicion, enforcementVisibility, communityDensity, economicPrecarity. Update every turn. Handle NeighborhoodEvents.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:12:41.014603-05:00","closed_at":"2026-01-14T23:12:41.014603-05:00","close_reason":"Implemented updateNeighborhoodPulse with cross-layer propagation from city/global, family influence"}
{"id":"icecream-14","title":"Implement Family impact system","description":"Implement FamilyImpact with visibility, stress, cohesion, trustNetworkStrength. These are modified by player choices and affect neighborhood pulses.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:12:41.121131-05:00","closed_at":"2026-01-14T23:12:41.121131-05:00","close_reason":"Implemented updateFamilyImpact with stress/cohesion dynamics based on neighborhood conditions"}
{"id":"icecream-15","title":"Implement event system","description":"Create event selection engine: weighted random based on pulse values, event pools per layer, severity scaling, duration tracking, and consequence resolution.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:13:43.33516-05:00","closed_at":"2026-01-14T23:13:43.33516-05:00","close_reason":"Implemented weighted random selection, trigger probability based on pulse, event templates for all layers, effect application, expiry pruning"}
{"id":"icecream-16","title":"Implement cross-layer propagation","description":"Implement propagation rules: effects flow down easily (global→city→neighborhood), up slowly. Use formulas from spec as starting point, tune for balance.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:13:43.444827-05:00","closed_at":"2026-01-14T23:13:43.444827-05:00","close_reason":"Already implemented in pulse.ts: global-\u003ecity-\u003eneighborhood propagation with formulas from spec, family influence on neighborhoods"}
{"id":"icecream-17","title":"Turn System Epic","description":"Implement the core gameplay loop: narrative prompts, player choices, unlock system, and consequence resolution within ~80 turn game arc.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:15:07.554597-05:00","closed_at":"2026-01-14T23:15:07.554597-05:00","close_reason":"Turn system complete: state machine, decision phase, choice/unlock, family variable effects"}
{"id":"icecream-18","title":"Design turn state machine","description":"Define turn phases: Plan → Pulse Update → Event → Decision → Consequence. Implement state machine with clear transitions and hooks for UI.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:14:53.023135-05:00","closed_at":"2026-01-14T23:14:53.023135-05:00","close_reason":"Implemented 5-phase turn loop (plan/pulse_update/event/decision/consequence), phase transitions, complete turn runner"}
{"id":"icecream-19","title":"Implement narrative prompt UI","description":"Build the core turn interface: display current situation, show narrative prompt text, render single-select and multi-select choice options.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:16:06.955992-05:00","closed_at":"2026-01-14T23:16:06.955992-05:00","close_reason":"Created NarrativePrompt component with single/multi-select, unlock conditions, choice effects display. Created StatusDisplay with family/neighborhood stat bars."}
{"id":"icecream-2","title":"Initialize Next.js app with Turbo","description":"Create the Next.js application using create-next-app with Turbo. Set up basic project structure, TypeScript config, and development environment.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:07:43.790214-05:00","closed_at":"2026-01-14T23:07:43.790214-05:00","close_reason":"Created Next.js app with TypeScript, Tailwind, ESLint, App Router, and Turbopack"}
{"id":"icecream-20","title":"Implement choice/unlock system","description":"Create system for conditional choice availability. Choices unlock based on: family variables, turn count, previous choices, neighborhood state, rights knowledge.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:14:53.133988-05:00","closed_at":"2026-01-14T23:14:53.133988-05:00","close_reason":"Implemented unlockConditions on choices (requiredChoices, minTurn, stats thresholds), filtering in decision generation"}
{"id":"icecream-21","title":"Connect choices to family variables","description":"Implement consequence engine: map player choices to family variable changes (visibility, stress, cohesion, trust network). Handle tradeoffs (work vs community).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:14:53.24406-05:00","closed_at":"2026-01-14T23:14:53.24406-05:00","close_reason":"Implemented effects application on family variables via applyEventEffects, choice recording in history"}
{"id":"icecream-22","title":"Content Generation Epic","description":"Generate all city profiles, neighborhood data, and event content for the 20 launch cities using the profiling pipeline.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-16T21:39:55.65064-05:00"}
{"id":"icecream-23","title":"Generate profiles for all 20 cities","description":"Run city profiling agent for: LA, SF, Phoenix, Seattle, El Paso, Tucson, San Antonio, Chicago, Detroit, Minneapolis, Columbus, Houston, Miami, Atlanta, Nashville, NYC, Boston, Philadelphia, Newark, Denver.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:40:02.328828-05:00","closed_at":"2026-01-14T23:40:02.328828-05:00","close_reason":"Generated city profiles for all 20 launch cities"}
{"id":"icecream-24","title":"Create base event pools","description":"Write/generate event templates for each event type: Audit, Checkpoint, RaidRumor, Meeting, Detention (neighborhood); Policy, Budget, Infrastructure, Media (city); Executive, Judicial, Media, Security (global).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:19:22.452764-05:00","closed_at":"2026-01-14T23:19:22.452764-05:00","close_reason":"Created 54 event templates across all layers: 18 neighborhood, 18 city, 18 global events"}
{"id":"icecream-25","title":"Create city-specific special events","description":"For each city, create 3-5 special events based on recent news that can dramatically shift neighborhood conditions. These become content refresh pipeline.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:22:05.801546-05:00","closed_at":"2026-01-14T23:22:05.801546-05:00","close_reason":"Created city-specific special events for 6 launch cities: LA, Chicago, Miami, Phoenix, NYC, Houston (30 events total)"}
{"id":"icecream-26","title":"Victory Conditions Epic","description":"Implement the three win conditions (Sanctuary, Outlast, Transform) and failure states with clear mechanical triggers.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:16:20.276019-05:00","closed_at":"2026-01-14T23:16:20.276019-05:00","close_reason":"Victory conditions epic complete: thresholds defined and detection implemented"}
{"id":"icecream-27","title":"Define victory/failure thresholds","description":"Specify exact conditions for each ending: Sanctuary (local protection threshold), Outlast (survive N turns until political shift), Transform (exposure/pressure threshold). Define failure states.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:16:20.054804-05:00","closed_at":"2026-01-14T23:16:20.054804-05:00","close_reason":"Defined in turn.ts: Sanctuary (trust\u003e=80, community\u003e=70, network\u003e=80), Outlast (survive maxTurns with climate\u003c40), Transform (cover\u003e=80, cooperation\u003c=20, narrative\u003c=-50), Failure (stress\u003e=95, cohesion\u003c=10)"}
{"id":"icecream-28","title":"Implement ending detection and resolution","description":"Create system to check win/loss conditions each turn, trigger appropriate ending sequences, and handle game completion state.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:16:20.166742-05:00","closed_at":"2026-01-14T23:16:20.166742-05:00","close_reason":"Implemented checkGameEnding() in turn.ts that checks all conditions each turn and sets GameEnding state"}
{"id":"icecream-2w5","title":"Create /dashboard cities list page","description":"## Deliverable\nCreate the main dashboard page showing all 20 cities in a grid layout with pulse summary.\n\n## Files to Modify\n- src/app/dashboard/page.tsx (replace placeholder)\n\n## Complexity: Medium\n\n## Implementation Details\n- Server component using getCities() from src/lib/content.ts\n- Grid layout with city cards (responsive: 1-3 columns)\n- Each card shows: city name, state, pulse values using PulseBar\n- Cards link to /dashboard/cities/[id]\n- Dark theme: bg-black, zinc-900 cards, amber accents\n\n## Dependencies\n- Requires PulseBar component (icecream-6nu)\n- Uses getCities() from content service\n\n## Acceptance Criteria\n- Page loads and displays all cities from Supabase\n- Cities shown in alphabetical order\n- Each city card shows name, state, and 5 pulse metrics\n- Clicking a card navigates to city detail page\n- No TypeScript errors","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-16T00:04:14.928851-05:00","created_by":"JB","updated_at":"2026-01-16T00:27:27.560966-05:00","closed_at":"2026-01-16T00:27:27.560966-05:00","close_reason":"Implemented cities list dashboard page with PulseBar component and content service","dependencies":[{"issue_id":"icecream-2w5","depends_on_id":"icecream-xaj","type":"blocks","created_at":"2026-01-16T00:04:24.626161-05:00","created_by":"JB"},{"issue_id":"icecream-2w5","depends_on_id":"icecream-6nu","type":"blocks","created_at":"2026-01-16T00:04:24.736785-05:00","created_by":"JB"}]}
{"id":"icecream-3","title":"Set up Redis connection and session management","description":"Integrate Redis client (ioredis or similar), implement session ID generation, and create basic get/set helpers for game state persistence.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:09:30.86-05:00","closed_at":"2026-01-14T23:09:30.86-05:00","close_reason":"Added ioredis client, session ID generation with uuid, get/set/delete game state helpers, 7-day TTL"}
{"id":"icecream-397","title":"ICE Cream Project: Integration \u0026 Polish","description":"\n# Integration \u0026 Polish\n\n**Priority:** P3\n**Dependencies:** All other beads\n\n## Overview\nIntegrate all systems together, add polish, and deploy the game.\n\n## Integration Tasks\n\n### 1. Main Game Loop Integration\n```tsx\n// src/App.tsx\nfunction App() {\n  const gameState = useGameState();\n  const queue = useQueue(gameState);\n  const [currentEntity, setCurrentEntity] = useState\u003cQueueEntity | null\u003e(null);\n  \n  return (\n    \u003cdiv className=\"game-container\" style={{ width: 360, height: 640 }}\u003e\n      \u003cPowerUpSlots slots={gameState.powerUps} /\u003e\n      \u003cCustomerQueue queue={queue} onSelect={setCurrentEntity} /\u003e\n      \u003cMeltOMeter state={gameState.visible} /\u003e\n      \u003cShopCounter featuredFlavor={gameState.visible.featuredFlavor} /\u003e\n      \u003cFlavorRoster workers={gameState.workers} /\u003e\n      \u003cMenuBar onAction={handleMenuAction} /\u003e\n      \n      {currentEntity \u0026\u0026 \u003cEntityOverlay entity={currentEntity} /\u003e}\n    \u003c/div\u003e\n  );\n}\n```\n\n### 2. State Persistence\n- Save to localStorage on each day end\n- Load from localStorage on refresh\n- Export/import save as JSON (for debugging)\n\n### 3. End-to-End Flow\n1. Start game → Main screen with all zones\n2. Select featured flavor → Day begins\n3. Queue generates → Customers arrive\n4. Interactions → State changes\n5. Agent encounter → Overlay appears\n6. Choices made → Resolution\n7. End of day → Summary screen\n8. Sleep → Next day\n\n### 4. Mobile Polish\n- Touch feedback (visual ripple)\n- Prevent scroll/zoom\n- Back button handling\n- Loading states\n\n### 5. Performance\n- Memoize expensive components\n- Lazy load overlays\n- Optimize re-renders\n\n### 6. Accessibility\n- Keyboard navigation\n- Screen reader labels\n- High contrast mode\n- Reduced motion option\n\n### 7. Deployment\n- Build for production\n- Test on mobile devices\n- Deploy to GitHub Pages / Netlify / Vercel\n\n## Acceptance Criteria\n- [ ] Full game playable from start to finish\n- [ ] Save/load working\n- [ ] No console errors\n- [ ] Mobile-optimized (tested on real device)\n- [ ] Performance: 60fps on target devices\n- [ ] Deployed and accessible via URL\n\n## Dependencies\n**BLOCKS ON:** All other beads complete\n","status":"closed","priority":3,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T19:34:11.31937-05:00","created_by":"mayor","updated_at":"2026-01-18T20:14:27.646114-05:00","closed_at":"2026-01-18T20:14:27.646114-05:00","close_reason":"Closed","dependencies":[{"issue_id":"icecream-397","depends_on_id":"icecream-ovg","type":"blocks","created_at":"2026-01-18T19:34:19.50772-05:00","created_by":"mayor"},{"issue_id":"icecream-397","depends_on_id":"icecream-55m","type":"blocks","created_at":"2026-01-18T19:34:19.605821-05:00","created_by":"mayor"},{"issue_id":"icecream-397","depends_on_id":"icecream-t9r","type":"blocks","created_at":"2026-01-18T19:34:19.70459-05:00","created_by":"mayor"}]}
{"id":"icecream-3an","title":"Pixel Art Assets \u0026 Color Palette","status":"open","priority":1,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T20:14:39.622109-05:00","created_by":"mayor","updated_at":"2026-01-18T20:14:39.622109-05:00","labels":["art","assets"]}
{"id":"icecream-4","title":"Define game state schema","description":"Define TypeScript interfaces for complete game state: GlobalPulse, CityPulse, NeighborhoodPulse, FamilyImpact, Events, and turn state. Store in Redis.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:14:58.13305-05:00","closed_at":"2026-01-14T23:14:58.13305-05:00","close_reason":"Implemented complete game state schema with types, validation, and factory functions"}
{"id":"icecream-5","title":"City Profiling Pipeline Epic","description":"Build tooling and agent workflows to generate structured city data from real news sources and demographic data for all 20 launch cities.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:18:09.986163-05:00","closed_at":"2026-01-14T23:18:09.986163-05:00","close_reason":"City Profiling Pipeline complete: NewsAPI, Census API, city profiler workflow all implemented"}
{"id":"icecream-55m","title":"ICE Cream Project: UI Components (6 Zones + Overlays)","description":"\n# UI Components (6 Zones + Overlays)\n\n**Priority:** P1\n**Dependencies:** TYPE-Foundation, SETUP-Base\n\n## Overview\nBuild all UI components for the 6 game zones plus overlay states. Components must be individually testable with Storybook-style state preview.\n\n## Zone Components\n\n### Zone 1: Power-Ups / Community Mechanics\n```tsx\n// src/components/shop/PowerUpSlots.tsx\ninterface PowerUpSlotsProps {\n  slots: PowerUpSlot[];\n  activePowerUp?: PowerUpType;\n  onSlotClick: (slot: PowerUpSlot) =\u003e void;\n}\n\ntype PowerUpSlot = {\n  id: string;\n  type: 'witness' | 'observer' | 'network';\n  status: 'available' | 'cooldown' | 'locked';\n  cooldownRemaining?: number;\n};\n```\n\n**States to test:**\n- All empty (locked)\n- One available (blinking)\n- One on cooldown (greyed, countdown)\n- Three active (full)\n\n### Zone 2: Customer Queue\n```tsx\n// src/components/shop/CustomerQueue.tsx\ninterface CustomerQueueProps {\n  queue: QueueEntity[];\n  visibleCount: number;\n  onEntityClick: (entity: QueueEntity) =\u003e void;\n}\n\ntype QueueEntity = Customer | Agent;\n```\n\n**States to test:**\n- Empty queue\n- Full queue (6 visible)\n- Agent at front\n- Agent in middle\n- \"...\" indicator (more in queue)\n\n### Zone 3: Melt-O-Meter\n```tsx\n// src/components/shop/MeltOMeter.tsx\ninterface MeltOMeterProps {\n  level: HeatLevel;\n  customerCount: number;\n  communitySupport: SupportLevel;\n  popularity: PopularityLevel;\n  dayNumber: number;\n}\n```\n\n**States to test:**\n- Calm (green, low fill)\n- Watched (yellow, medium fill)\n- Tense (orange, high fill)\n- Critical (red, full fill, drip animation)\n\n### Zone 4: Shop Counter\n```tsx\n// src/components/shop/ShopCounter.tsx\ninterface ShopCounterProps {\n  featuredFlavor?: WorkerId;\n}\n```\n\n**States to test:**\n- No featured flavor\n- Featured flavor shown\n\n### Zone 5: Flavor Roster\n```tsx\n// src/components/shop/FlavorRoster.tsx\ninterface FlavorRosterProps {\n  workers: Worker[];\n  featuredFlavor?: WorkerId;\n  onWorkerClick: (worker: Worker) =\u003e void;\n  onWorkerLongPress: (worker: Worker) =\u003e void;\n}\n```\n\n**States to test:**\n- All 6 workers present\n- One featured (flashing border)\n- One stepped back (darkened, offset)\n- One removed (dithered grey, \"GONE\" text)\n- Multiple removed\n\n### Zone 6: Menu Bar\n```tsx\n// src/components/shop/MenuBar.tsx\ninterface MenuBarProps {\n  petitionsCollected: number;\n  protestUnlocked: boolean;\n  onMenuAction: (action: MenuAction) =\u003e void;\n  contextualActions?: ContextAction[];\n}\n```\n\n**States to test:**\n- Default (4 icons)\n- Protest greyed (not enough signatures)\n- Contextual actions active\n- Morning phase (Start Day button)\n\n## Overlay Components\n\n### Dialogue Overlay\n```tsx\n// src/components/dialogue/DialogueOverlay.tsx\ninterface DialogueOverlayProps {\n  lines: DialogueLine[];\n  choices?: DialogueChoice[];\n  onChoice: (choiceId: string) =\u003e void;\n  typewriterSpeed?: number;\n}\n\ninterface DialogueLine {\n  speaker: 'agent' | 'worker' | 'narrator';\n  text: string;\n}\n\ninterface DialogueChoice {\n  id: string;\n  text: string;\n  enabled: boolean;\n}\n```\n\n**States to test:**\n- Single line, no choices (auto-advance)\n- Multiple lines with choices\n- Disabled choices (greyed out)\n- Typewriter effect in progress\n\n### Encounter Overlay\n```tsx\n// src/components/encounter/EncounterOverlay.tsx\ninterface EncounterOverlayProps {\n  encounter: AgentEncounter;\n  currentStep: EncounterStep;\n  onChoice: (choice: string) =\u003e void;\n  onDocumentInspect: () =\u003e void;\n}\n```\n\n**States to test:**\n- Declaration phase (no choices)\n- Choice phase (4-6 options)\n- Document inspection mode\n- Resolution phase\n\n### Document Display\n```tsx\n// src/components/encounter/DocumentDisplay.tsx\ninterface DocumentDisplayProps {\n  document: AgentDocument;\n  onPointOutError: () =\u003e void;\n  onReturnPapers: () =\u003e void;\n}\n```\n\n**States to test:**\n- Correct document\n- Incorrect document (wrong name)\n- Incomplete document\n- No document\n\n### End of Day Summary\n```tsx\n// src/components/summary/EndOfDaySummary.tsx\ninterface EndOfDaySummaryProps {\n  dayNumber: number;\n  summary: DaySummary;\n  onContinue: () =\u003e void;\n}\n\ninterface DaySummary {\n  narrative: string;\n  customersServed: number;\n  communitySupportChange: 'up' | 'down' | 'same';\n  meltOMeterChange: 'up' | 'down' | 'same';\n  workersRemoved: WorkerId[];\n}\n```\n\n**States to test:**\n- Good day (all positive)\n- Bad day (worker removed)\n- Mixed day\n- Oregon Trail-style progress bars\n\n## Component Testing Strategy\n\nEach component should have a corresponding test file with state previews:\n\n```tsx\n// src/components/shop/FlavorRoster.test.tsx\nimport { render, screen } from '@testing-library/react';\nimport { FlavorRoster } from './FlavorRoster';\n\ndescribe('FlavorRoster', () =\u003e {\n  const testStates = {\n    allPresent: {\n      workers: [...allSixWorkers],\n      featuredFlavor: 'strawberry',\n    },\n    oneRemoved: {\n      workers: workersExcept('cotton-candy'),\n      featuredFlavor: undefined,\n    },\n    multipleRemoved: {\n      workers: [vanilla, chocolate],\n      featuredFlavor: 'vanilla',\n    },\n  };\n  \n  it('renders all workers when present', () =\u003e {\n    render(\u003cFlavorRoster {...testStates.allPresent} /\u003e);\n    expect(screen.getAllByRole('listitem')).toHaveLength(6);\n  });\n  \n  it('shows gone styling for removed workers', () =\u003e {\n    render(\u003cFlavorRoster {...testStates.oneRemoved} /\u003e);\n    expect(screen.getByText('GONE')).toBeInTheDocument();\n  });\n});\n```\n\n## File Structure\n```\nsrc/components/\n├── shop/\n│   ├── PowerUpSlots.tsx\n│   ├── CustomerQueue.tsx\n│   ├── MeltOMeter.tsx\n│   ├── ShopCounter.tsx\n│   ├── FlavorRoster.tsx\n│   └── MenuBar.tsx\n├── dialogue/\n│   └── DialogueOverlay.tsx\n├── encounter/\n│   ├── EncounterOverlay.tsx\n│   └── DocumentDisplay.tsx\n├── summary/\n│   └── EndOfDaySummary.tsx\n└── index.ts                  # Export all\n```\n\n## Pixel Art Styling\n\nAll components must follow the pixel art rules:\n- Square corners only (no rounded)\n- Banded colors (no gradients)\n- Pixel fonts (Press Start 2P/VT323)\n- Touch targets minimum 44px\n- Grid-aligned layouts\n\n## Acceptance Criteria\n- [ ] All 6 zone components implemented\n- [ ] All overlay components implemented\n- [ ] Each component has test file with state previews\n- [ ] Pixel art styling applied (no rounded corners, no gradients)\n- [ ] Color palette imported from `types/colors.ts` (no hardcoded colors)\n- [ ] Touch targets verified (44px minimum)\n- [ ] Components render at 360×640 without scroll\n\n## Dependencies\n**BLOCKS ON:** \n- TYPE-Foundation (need types)\n- SETUP-Base (need React + Tailwind set up)\n\n## Notes\n- Consider adding Storybook later for visual testing\n- For now, use test files with different state snapshots\n- Use CSS Grid for the main layout (6 zones)\n","status":"closed","priority":1,"issue_type":"feature","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T19:33:25.310009-05:00","created_by":"mayor","updated_at":"2026-01-18T20:14:27.643396-05:00","closed_at":"2026-01-18T20:14:27.643396-05:00","close_reason":"Closed","labels":["components","ui"],"dependencies":[{"issue_id":"icecream-55m","depends_on_id":"icecream-86x","type":"blocks","created_at":"2026-01-18T19:34:19.10095-05:00","created_by":"mayor"},{"issue_id":"icecream-55m","depends_on_id":"icecream-9v3","type":"blocks","created_at":"2026-01-18T19:34:19.202578-05:00","created_by":"mayor"}]}
{"id":"icecream-6","title":"Set up NewsAPI integration","description":"Create utility to fetch recent news (2-3 months) for specific cities using NewsAPI.org. Focus on immigration, enforcement, sanctuary policy, and local politics keywords.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:11:50.442683-05:00","closed_at":"2026-01-14T23:11:50.442683-05:00","close_reason":"Created NewsAPI utility with searchCityImmigrationNews, searchCityPoliticsNews, getCityProfilingNews. Supports 2-3 month lookback, deduplication, agent-friendly formatting."}
{"id":"icecream-6nu","title":"Create PulseBar reusable component for pulse visualization","description":"## Deliverable\nCreate a reusable PulseBar component for visualizing pulse values (0-100 scale) consistently across the dashboard. Based on the StatBar pattern from StatusDisplay.tsx.\n\n## Files to Create\n- src/components/dashboard/PulseBar.tsx\n\n## Complexity: Small\n\n## Implementation Details\n- Server component (no 'use client' needed)\n- Props: label, value (0-100), color (amber/red/green/blue)\n- Visual: horizontal bar with fill based on value percentage\n- Follow existing dark theme: zinc-700 background, colored fill\n\n## Acceptance Criteria\n- Component renders pulse values as horizontal bars\n- Supports multiple color variants\n- Follows existing StatusDisplay styling patterns\n- No TypeScript errors","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-16T00:04:14.712021-05:00","created_by":"JB","updated_at":"2026-01-16T00:24:21.779977-05:00","closed_at":"2026-01-16T00:24:21.779977-05:00","close_reason":"Created PulseBar component with label, value (0-100), and color variants","dependencies":[{"issue_id":"icecream-6nu","depends_on_id":"icecream-xaj","type":"blocks","created_at":"2026-01-16T00:04:24.51286-05:00","created_by":"JB"}]}
{"id":"icecream-7","title":"Set up Census ACS API integration","description":"Create utility to fetch demographic data from Census American Community Survey API. Target: population, median income, foreign-born %, language data, housing costs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:17:11.510572-05:00","closed_at":"2026-01-14T23:17:11.510572-05:00","close_reason":"Already implemented: getCityDemographics, getAllLaunchCityDemographics, FIPS mappings for all 20 cities, formatDemographicsForAgent"}
{"id":"icecream-8","title":"Define city data schema","description":"Define TypeScript interfaces matching the spec: CityPulse, NeighborhoodPulse, CityEvent, NeighborhoodEvent. Include validation and defaults.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:11:06.633622-05:00","closed_at":"2026-01-14T23:11:06.633622-05:00","close_reason":"Defined CityProfile, Neighborhood, CityPulse, NeighborhoodPulse, event templates. Includes 20 launch cities list."}
{"id":"icecream-86x","title":"ICE Cream Project: TypeScript Type System Foundation","description":"\n# TypeScript Type System Foundation\n\n**Priority:** P0 (Blocks almost everything else)\n\n## Overview\nDefine ALL TypeScript types/interfaces for the entire game. This is the foundation that all other systems depend on.\n\n## Types to Define\n\n### 1. Core Game State\n```typescript\ninterface GameState {\n  day: number;\n  phase: 'open-operation' | 'selective-enforcement' | 'procedural-conflict' | 'constraint-saturation';\n  visible: VisibleState;\n  hidden: HiddenState;\n}\n```\n\n### 2. Visible State (Player-Facing)\n```typescript\ninterface VisibleState {\n  popularity: PopularityLevel;    // 'very-low' | 'low' | 'medium' | 'high' | 'very-high'\n  meltOMeter: HeatLevel;          // 'calm' | 'watched' | 'tense' | 'critical'\n  communitySupport: SupportLevel; // 'none' | 'low' | 'medium' | 'high' | 'very-high'\n  staffRoster: WorkerId[];\n  featuredFlavor: WorkerId;\n}\n```\n\n### 3. Hidden State (System-Only)\n```typescript\ninterface HiddenState {\n  visibility: number;              // 0-100\n  workerRiskProfiles: Record\u003cWorkerId, number\u003e;\n  customerArchetypeDrift: ArchetypeState;\n  agentAggressionProfile: AggressionLevel;\n  documentationQuality: DocQuality;\n  legitimacyThresholds: LegitimacyState;\n}\n```\n\n### 4. Workers/Flavors\n```typescript\ntype WorkerId = 'vanilla' | 'chocolate' | 'strawberry' | 'butter-pecan' | 'pistachio' | 'cotton-candy';\n\ninterface Worker {\n  id: WorkerId;\n  name: string;\n  status: 'present' | 'featured' | 'stepped-back' | 'removed' | 'unavailable';\n  symbolicWeight: number;  // 1-10, affects protest effectiveness\n}\n```\n\n### 5. Agents \u0026 Encounters\n```typescript\ninterface AgentEncounter {\n  targetWorker: WorkerId;\n  documentation: Documentation;\n  aggressionProfile: AggressionLevel;\n  steps: EncounterStep[];\n}\n\ntype DocumentationQuality = 'none' | 'incomplete' | 'incorrect' | 'correct' | 'comprehensive';\n```\n\n### 6. Customers \u0026 Queue\n```typescript\ninterface Customer {\n  id: string;\n  archetype: CustomerArchetype;\n  preferredFlavor?: WorkerId;\n  willSignPetition: boolean;\n  reactionToRemove: Record\u003cWorkerId, ReactionType\u003e;\n}\n\ntype CustomerArchetype = 'regular' | 'nervous' | 'enthusiastic' | 'suspicious' | 'solidarity';\n```\n\n### 7. Community \u0026 Resistance\n```typescript\ninterface ResistanceState {\n  petitionsCollected: number;\n  protestsAttended: number;\n  documentationRequestsFiled: number;\n  equipmentBansActive: EquipmentBan[];\n  communityDefenseUses: number;\n}\n```\n\n### 8. UI State Types\n```typescript\ninterface UIState {\n  currentZone: GameZone;\n  activeOverlay: OverlayType | null;\n  dialogueQueue: DialogueLine[];\n  menuState: MenuState;\n}\n\ntype GameZone = 'power-ups' | 'queue' | 'meltometer' | 'counter' | 'roster' | 'menu';\ntype OverlayType = 'encounter' | 'dialogue' | 'document' | 'summary' | 'protest' | 'recovery';\n```\n\n### 9. Color Palette Types\n```typescript\ninterface ColorPalette {\n  powerUp: { primary: string; secondary: string; accent: string; };\n  queue: { primary: string; secondary: string; accent: string; };\n  meltOMeter: { low: string; medium: string; high: string; };\n  counter: { primary: string; secondary: string; accent: string; };\n  menu: { background: string; border: string; text: string; };\n  dialogue: { background: string; text: string; };\n  background: { primary: string; secondary: string; };\n  text: { primary: string; secondary: string; };\n}\n```\n\n## File Structure\n```\nsrc/types/\n├── index.ts           # Re-exports all types\n├── core.ts            # GameState, core interfaces\n├── workers.ts         # Worker, WorkerId, worker-related\n├── encounters.ts      # Agent, Documentation, Encounter types\n├── customers.ts       # Customer, Queue, Archetype types\n├── resistance.ts      # Petition, Protest, Community Defense\n├── ui.ts              # UIState, Overlay, Zone types\n├── colors.ts          # ColorPalette (single source of truth)\n└── constants.ts       # Game constants, initial state\n```\n\n## Acceptance Criteria\n- [ ] All types defined with strict TypeScript (no `any`)\n- [ ] Single source of truth for color palette in `types/colors.ts`\n- [ ] Initial game state exportable from `types/constants.ts`\n- [ ] All types exportable from `types/index.ts`\n- [ ] JSDoc comments on all exported interfaces\n- [ ] No circular type dependencies\n\n## Dependencies\n**NONE** - This is the foundation\n\n## Blocks\n- Game Engine\n- UI Components\n- Content System\n","status":"closed","priority":0,"issue_type":"feature","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T19:33:24.536149-05:00","created_by":"mayor","updated_at":"2026-01-18T20:14:27.641946-05:00","closed_at":"2026-01-18T20:14:27.641946-05:00","close_reason":"Closed","labels":["foundation","types"]}
{"id":"icecream-9","title":"Create city profiling agent workflow","description":"Design agent prompt and workflow that takes NewsAPI + Census data and produces structured city profiles per CITY_PROFILING_BRIEF. Output: JSON city files.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-14T23:00:06.742424-05:00","updated_at":"2026-01-14T23:18:09.877294-05:00","closed_at":"2026-01-14T23:18:09.877294-05:00","close_reason":"Created city-profiler.ts: gatherCityProfilingContext, generateCityProfilingPrompt, parseAgentResponse, convertToGameProfile, default event generators"}
{"id":"icecream-9rf","title":"Create /dashboard/cities/[id] city detail page","description":"## Deliverable\nCreate the city detail page showing city overview and all neighborhoods with their pulse values.\n\n## Files to Modify\n- src/app/dashboard/cities/[id]/page.tsx (replace placeholder)\n\n## Complexity: Medium\n\n## Implementation Details\n- Server component using getCityWithNeighborhoods(id) from src/lib/content.ts\n- Display city name, state, overview text\n- Show city pulse values using PulseBar\n- List all neighborhoods with:\n  - Name and description\n  - Neighborhood pulse values (trust, suspicion, etc.)\n- Back link to /dashboard\n- Handle 404 case if city not found\n\n## Dependencies\n- Requires PulseBar component (icecream-6nu)\n- Uses getCityWithNeighborhoods() from content service\n\n## Acceptance Criteria\n- Page loads city data from Supabase by ID\n- Shows city overview and pulse metrics\n- Lists all neighborhoods with their pulse values\n- Returns 404 for invalid city IDs\n- No TypeScript errors","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-16T00:04:15.132068-05:00","created_by":"JB","updated_at":"2026-01-16T00:26:57.04729-05:00","closed_at":"2026-01-16T00:26:57.04729-05:00","close_reason":"Created city detail page with neighborhood list and pulse metrics","dependencies":[{"issue_id":"icecream-9rf","depends_on_id":"icecream-6nu","type":"blocks","created_at":"2026-01-16T00:04:24.851266-05:00","created_by":"JB"}]}
{"id":"icecream-9v3","title":"ICE Cream Project: Base Setup \u0026 Tooling","description":"\n# Base Setup \u0026 Tooling\n\n**Priority:** P0 (Can work in parallel with TYPES)\n\n## Overview\nSet up the React + TypeScript project with all necessary tooling for a one-day game jam.\n\n## Tech Stack\n- **Framework:** React 18 with Vite (fast dev server, optimized builds)\n- **Language:** TypeScript 5.x\n- **Styling:** Tailwind CSS v4 (utility-first, matches pixel art needs)\n- **Testing:** Vitest + React Testing Library\n- **State:** Zustand (lightweight, no boilerplate)\n- **Fonts:** Google Fonts (Press Start 2P or VT323 for pixel art)\n\n## Setup Tasks\n\n### 1. Project Initialization\n```bash\nnpm create vite@latest icecream -- --template react-ts\ncd icecream\nnpm install\n```\n\n### 2. Install Dependencies\n```bash\n# Runtime\nnpm install zustand\n\n# Testing\nnpm install -D vitest @testing-library/react @testing-library/jest-dom @testing-library/user-event\n\n# Pixel font\n# (We'll use Google Fonts CDN for simplicity)\n```\n\n### 3. Configure Vite\n- Set up port 5173\n- Enable HMR\n- Configure build for static hosting\n\n### 4. Configure Tailwind CSS v4\n```css\n/* src/styles.css - SINGLE SOURCE FOR COLOR IMPORT */\n@import 'tailwindcss';\n@theme {\n  /* Colors will be imported from types/colors.ts */\n}\n```\n\n### 5. Configure Vitest\n```js\n// vitest.config.ts\nimport { defineConfig } from 'vitest/config';\nimport react from '@vitejs/plugin-react';\n\nexport default defineConfig({\n  plugins: [react()],\n  test: {\n    globals: true,\n    environment: 'jsdom',\n  },\n});\n```\n\n### 6. Project Structure\n```\nsrc/\n├── App.tsx                 # Root component\n├── main.tsx                # Entry point\n├── styles.css              # Global styles + Tailwind\n├── types/                  # TypeScript types\n├── components/             # React components\n│   ├── shop/              # Zone 1-5 components\n│   ├── dialogue/          # Dialogue overlay\n│   ├── encounter/         # Agent encounter UI\n│   └── summary/           # End-of-day summary\n├── hooks/                  # Custom React hooks\n├── store/                  # Zustand stores\n├── engine/                 # Game engine\n├── content/                # Encounter grammars, templates\n└── utils/                  # Helper functions\n```\n\n### 7. Base Configuration Files\n- `package.json` with scripts\n- `tsconfig.json` with strict mode\n- `vite.config.ts`\n- `vitest.config.ts`\n- `.gitignore` (node_modules, dist, .env)\n- `index.html` with viewport meta for mobile\n\n### 8. Mobile Meta Tags\n```html\n\u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\"\u003e\n\u003cmeta name=\"apple-mobile-web-app-capable\" content=\"yes\"\u003e\n```\n\n## Acceptance Criteria\n- [ ] Vite dev server runs (`npm run dev`)\n- [ ] TypeScript compiles without errors\n- [ ] Tailwind CSS loads (test with utility class)\n- [ ] Vitest runs (`npm run test`)\n- [ ] Project structure created\n- [ ] Mobile viewport configured (360×640 target)\n\n## Dependencies\n**NONE** - Can start immediately\n\n## Notes\n- Can work in parallel with TYPES bead\n- Once TYPES is complete, import types into store and components\n","status":"closed","priority":0,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T19:33:24.789163-05:00","created_by":"mayor","updated_at":"2026-01-18T20:14:27.640251-05:00","closed_at":"2026-01-18T20:14:27.640251-05:00","close_reason":"Closed","labels":["setup","tooling"]}
{"id":"icecream-avd","title":"Create About page content","description":"Write content for the About page explaining the game's purpose, design philosophy, and team. Should convey: dark satire with educational intent, inspired by Papers Please/This War of Mine, teaches rights and systemic dynamics not evasion tactics. Follow tone guide.","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-14T23:33:51.388458-05:00","created_by":"JB","updated_at":"2026-01-16T00:24:30.299848-05:00","closed_at":"2026-01-16T00:24:30.299848-05:00","close_reason":"Created About page with game purpose, design philosophy, and inspirations","dependencies":[{"issue_id":"icecream-avd","depends_on_id":"icecream-rz3","type":"blocks","created_at":"2026-01-14T23:34:22.998811-05:00","created_by":"JB"}]}
{"id":"icecream-b3c","title":"Base Setup \u0026 Tooling","status":"open","priority":0,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T20:14:39.411022-05:00","created_by":"mayor","updated_at":"2026-01-18T20:14:39.411022-05:00","labels":["setup","tooling"]}
{"id":"icecream-bq6","title":"Verify dashboard pages work correctly","description":"## Deliverable\nVerify the dashboard implementation works correctly end-to-end.\n\n## Files to Check\n- src/app/dashboard/page.tsx\n- src/app/dashboard/cities/[id]/page.tsx\n- src/components/dashboard/PulseBar.tsx\n\n## Complexity: Small\n\n## Verification Steps\n1. Run tests: pnpm test (all tests must pass)\n2. Start dev server: pnpm dev\n3. Visit /dashboard - should see 20 cities\n4. Verify pulse bars display correctly for each city\n5. Click a city card - should navigate to /dashboard/cities/[id]\n6. Verify city detail shows overview + neighborhoods\n7. Verify neighborhood pulse values display correctly\n8. Test back navigation to /dashboard\n9. Test invalid city ID returns 404\n\n## Acceptance Criteria\n- All tests pass (pnpm test)\n- All 20 cities display on dashboard\n- City detail pages load correctly\n- Navigation works between pages\n- No console errors\n- No TypeScript errors","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-16T00:04:15.336999-05:00","created_by":"JB","updated_at":"2026-01-16T00:31:27.118445-05:00","closed_at":"2026-01-16T00:31:27.118445-05:00","close_reason":"Verification: 29 tests pass, 20 city files available. Manual verification (dev server, navigation) recommended.","dependencies":[{"issue_id":"icecream-bq6","depends_on_id":"icecream-2w5","type":"blocks","created_at":"2026-01-16T00:04:24.965373-05:00","created_by":"JB"},{"issue_id":"icecream-bq6","depends_on_id":"icecream-9rf","type":"blocks","created_at":"2026-01-16T00:04:25.076539-05:00","created_by":"JB"},{"issue_id":"icecream-bq6","depends_on_id":"icecream-du3","type":"blocks","created_at":"2026-01-16T00:08:46.692987-05:00","created_by":"JB"},{"issue_id":"icecream-bq6","depends_on_id":"icecream-xvv","type":"blocks","created_at":"2026-01-16T00:08:46.809158-05:00","created_by":"JB"},{"issue_id":"icecream-bq6","depends_on_id":"icecream-j71","type":"blocks","created_at":"2026-01-16T00:08:46.919732-05:00","created_by":"JB"}]}
{"id":"icecream-du3","title":"Write PulseBar component tests","description":"## Deliverable\nUnit tests for the PulseBar component covering all use cases.\n\n## Files to Create\n- src/components/dashboard/PulseBar.test.tsx\n\n## Complexity: Small\n\n## Test Cases\n1. Renders label correctly\n2. Renders value text (0-100)\n3. Bar width matches value percentage (0%, 50%, 100%)\n4. Supports all color variants (amber, red, green, blue)\n5. Handles edge cases: value=0, value=100\n6. Handles boundary values: negative numbers clamp to 0, \u003e100 clamps to 100\n\n## Dependencies\n- Requires test infrastructure (icecream-uf7)\n- Requires PulseBar component (icecream-6nu)\n\n## Acceptance Criteria\n- All test cases pass\n- Tests cover happy path and edge cases\n- No mocking needed (pure presentational component)","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-16T00:08:24.058902-05:00","created_by":"JB","updated_at":"2026-01-16T00:29:28.345824-05:00","closed_at":"2026-01-16T00:29:28.345824-05:00","close_reason":"Added 12 tests covering all use cases: rendering, value clamping, color variants","dependencies":[{"issue_id":"icecream-du3","depends_on_id":"icecream-uf7","type":"blocks","created_at":"2026-01-16T00:08:46.012118-05:00","created_by":"JB"},{"issue_id":"icecream-du3","depends_on_id":"icecream-6nu","type":"blocks","created_at":"2026-01-16T00:08:46.122704-05:00","created_by":"JB"}]}
{"id":"icecream-dvw","title":"UI Components (6 Zones + Overlays)","description":"ICE Cream: All zone components + overlays.","status":"open","priority":1,"issue_type":"feature","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T20:29:05.784141-05:00","created_by":"mayor","updated_at":"2026-01-18T20:29:05.784141-05:00","labels":["components","ui"]}
{"id":"icecream-eo5","title":"TypeScript Type System Foundation","status":"open","priority":0,"issue_type":"feature","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T20:14:39.197416-05:00","created_by":"mayor","updated_at":"2026-01-18T20:14:39.197416-05:00","labels":["foundation","types"]}
{"id":"icecream-f1i","title":"Create Resources page with real legal info","description":"Curate page linking to actual Know Your Rights resources, legal hotlines, and immigrant advocacy organizations. Not gameplay—real resources for real people. Include: ACLU Know Your Rights, United We Dream, local legal aid directories.","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-14T23:33:52.013858-05:00","created_by":"JB","updated_at":"2026-01-14T23:37:30.613907-05:00","closed_at":"2026-01-14T23:37:30.613907-05:00","close_reason":"Created /support and /resources pages with NGO links and Know Your Rights resources"}
{"id":"icecream-fnx","title":"ICE Cream Project: Pixel Art Assets \u0026 Color Palette","description":"\n# Pixel Art Assets \u0026 Color Palette\n\n**Priority:** P2\n**Dependencies:** None (can work in parallel)\n\n## Overview\nCreate or organize pixel art assets and define the canonical color palette. User will provide UI assets.\n\n## Color Palette (Single Source of Truth)\n\n```typescript\n// src/styles/colors.ts - ⚠️ SINGLE SOURCE OF TRUTH\nexport const colors = {\n  // Power-ups (Red)\n  powerUp: {\n    primary: '#8B0000',\n    secondary: '#CD5C5C',\n    accent: '#FFA07A',\n  },\n  // Queue (Orange)\n  queue: {\n    primary: '#8B4513',\n    secondary: '#D2691E',\n    accent: '#FFDAB9',\n  },\n  // Melt-O-Meter\n  meltOMeter: {\n    low: '#228B22',      // Green\n    medium: '#FFD700',   // Yellow\n    high: '#FF4500',     // Red\n  },\n  // Counter \u0026 Flavors (Blue)\n  counter: {\n    primary: '#000080',\n    secondary: '#4169E1',\n    accent: '#87CEEB',\n  },\n  // Menu (Black/Grey)\n  menu: {\n    background: '#000000',\n    border: '#333333',\n    text: '#666666',\n  },\n  // Dialogue\n  dialogue: {\n    background: '#2A2A2A',\n    text: '#FFFFFF',\n  },\n  // Background\n  background: {\n    primary: '#F5F5DC',\n    secondary: '#FFFAF0',\n  },\n  // Text\n  text: {\n    primary: '#000000',\n    secondary: '#FFFFFF',\n  },\n} as const;\n```\n\n## Asset List\n\n### Sprites Needed\n\n| Sprite | Size | Description | States |\n|--------|------|-------------|--------|\n| Customer | 32×32 | Basic customer sprite | 3 variations (regular, nervous, enthusiastic) |\n| Agent | 48×48 | ICE Cream Agent | White uniform, ice cream cone badge, permanent smile |\n| Worker (Vanilla) | 24×24 | Ice cream scoop | Cream/white pixels |\n| Worker (Chocolate) | 24×24 | Ice cream scoop | Brown pixels |\n| Worker (Strawberry) | 24×24 | Ice cream scoop | Pink pixels + ★ marker |\n| Worker (Butter Pecan) | 24×24 | Ice cream scoop | Tan with pixel speckles |\n| Worker (Pistachio) | 24×24 | Ice cream scoop | Green pixels |\n| Worker (Cotton Candy) | 24×24 | Ice cream scoop | Blue-pink dithered pattern |\n\n### Icons Needed (16×16, 1-bit)\n- Clipboard (Petitions)\n- Megaphone (Protest)\n- Gear (Settings)\n- Question mark (Help)\n\n### UI Elements\n- Counter texture (wood grain dithering)\n- Paper texture (for documents)\n- Melt-O-Meter drip frames (3 frames for animation)\n\n## Asset Organization\n\n```\npublic/\n└── assets/\n    ├── sprites/\n    │   ├── customers/\n    │   │   ├── customer-regular.png\n    │   │   ├── customer-nervous.png\n    │   │   └── customer-enthusiastic.png\n    │   ├── agents/\n    │   │   └── agent.png\n    │   └── workers/\n    │       ├── vanilla.png\n    │       ├── chocolate.png\n    │       ├── strawberry.png\n    │       ├── butter-pecan.png\n    │       ├── pistachio.png\n    │       └── cotton-candy.png\n    ├── icons/\n    │   ├── clipboard.png\n    │   ├── megaphone.png\n    │   ├── gear.png\n    │   └── help.png\n    └── textures/\n        ├── counter.png\n        ├── paper.png\n        └── meltometer-drip-1.png\n```\n\n## Font Loading\n\n```html\n\u003c!-- index.html --\u003e\n\u003clink rel=\"preconnect\" href=\"https://fonts.googleapis.com\"\u003e\n\u003clink rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin\u003e\n\u003clink href=\"https://fonts.googleapis.com/css2?family=VT323\u0026display=swap\" rel=\"stylesheet\"\u003e\n```\n\n```css\n/* src/styles.css */\n:root {\n  --font-pixel: 'VT323', monospace;\n}\n\nbody {\n  font-family: var(--font-pixel);\n}\n```\n\n## Asset Generation Options\n\nSince we're doing a one-day game jam:\n\n1. **User provides assets** (preferred - you mentioned you have UI assets)\n2. **Quick pixel art tools:**\n   - [Piskel](https://www.piskelapp.com/) - Free, browser-based\n   - [Aseprite](https://www.aseprite.org/) - Paid, powerful\n   - [Pixelator](https://pixelator.app/) - Convert images to pixel art\n3. **AI generation** with specific prompts for pixel art\n\n## Acceptance Criteria\n- [ ] Color palette defined in `src/styles/colors.ts`\n- [ ] All sprite assets created/organized\n- [ ] Font loading configured (VT323 or Press Start 2P)\n- [ ] No hardcoded colors in components\n- [ ] Assets follow pixel art constraints (no anti-aliasing, square pixels)\n\n## Dependencies\n**NONE** - Can start immediately\n\n## Notes\n- User will provide UI assets - this task is about organizing them\n- Color palette file must be created before UI components (they import from it)\n- Consider using CSS custom properties for theme colors\n","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T19:33:59.358492-05:00","created_by":"mayor","updated_at":"2026-01-18T20:14:27.644781-05:00","closed_at":"2026-01-18T20:14:27.644781-05:00","close_reason":"Closed","labels":["art","assets"]}
{"id":"icecream-hvm","title":"Game Engine \u0026 State Management","description":"ICE Cream: Game loop engine, queue generator, encounter resolution, state management with Zustand.","status":"open","priority":1,"issue_type":"feature","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T20:29:05.417429-05:00","created_by":"mayor","updated_at":"2026-01-18T20:29:05.417429-05:00","labels":["engine","state"]}
{"id":"icecream-hzs","title":"Review: Validate dashboard implementation","description":"## Review: Cities \u0026 Neighborhoods Dashboard\n\n### Required Reading (MANDATORY)\n- [ ] FACT_SHEET.md - Core design principles and ethical guardrails\n- [ ] This review task - Full context on what was implemented\n\n### Review Checklist\n- [ ] Dashboard displays all 20 cities correctly\n- [ ] City pulse values render properly (0-100 scale)\n- [ ] City detail pages show overview and neighborhoods\n- [ ] Neighborhood pulse values display correctly\n- [ ] Navigation between pages works\n- [ ] Dark theme styling consistent with existing UI\n- [ ] No TypeScript errors\n- [ ] Code follows existing patterns (server components, content service)\n\n### If Issues Found\nCreate follow-up issues for any violations or gaps discovered.","status":"closed","priority":1,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-16T00:06:34.276392-05:00","created_by":"JB","updated_at":"2026-01-16T00:31:59.926744-05:00","closed_at":"2026-01-16T00:31:59.926744-05:00","close_reason":"Review passed: FACT_SHEET compliant, 29 tests pass, all checklist items verified","dependencies":[{"issue_id":"icecream-hzs","depends_on_id":"icecream-bq6","type":"blocks","created_at":"2026-01-16T00:06:38.487967-05:00","created_by":"JB"}]}
{"id":"icecream-j71","title":"Write city detail page tests","description":"## Deliverable\nTests for the /dashboard/cities/[id] city detail page.\n\n## Files to Create\n- src/app/dashboard/cities/[id]/page.test.tsx\n\n## Complexity: Medium\n\n## Test Cases\n1. Renders city name and state as heading\n2. Displays city overview text\n3. Shows city pulse bars with correct values\n4. Lists all neighborhoods\n5. Each neighborhood shows name, description, and pulse bars\n6. Back link navigates to /dashboard\n7. Returns 404/not found for invalid city ID\n8. Handles city with no neighborhoods (empty neighborhoods array)\n\n## Dependencies\n- Requires test infrastructure (icecream-uf7)\n- Requires city detail page (icecream-9rf)\n\n## Mocking Required\n- Mock getCityWithNeighborhoods() from content service\n- Mock notFound() from next/navigation for 404 case\n- Provide sample city + neighborhoods fixtures\n\n## Acceptance Criteria\n- All test cases pass\n- Content service properly mocked\n- 404 behavior tested\n- Neighborhood rendering verified","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-16T00:08:38.057462-05:00","created_by":"JB","updated_at":"2026-01-16T00:30:53.86471-05:00","closed_at":"2026-01-16T00:30:53.86471-05:00","close_reason":"Added 10 tests for city detail page with mocked content service and notFound","dependencies":[{"issue_id":"icecream-j71","depends_on_id":"icecream-uf7","type":"blocks","created_at":"2026-01-16T00:08:46.457941-05:00","created_by":"JB"},{"issue_id":"icecream-j71","depends_on_id":"icecream-9rf","type":"blocks","created_at":"2026-01-16T00:08:46.57522-05:00","created_by":"JB"}]}
{"id":"icecream-jho","title":"ICE Cream Project: Testing Infrastructure","description":"\n# Testing Infrastructure\n\n**Priority:** P2\n**Dependencies:** SETUP-Base (can work in parallel)\n\n## Overview\nSet up comprehensive testing infrastructure for the game. Each component must be testable in isolation with state previews.\n\n## Testing Stack\n- **Unit Tests:** Vitest (comes with SETUP)\n- **Component Tests:** React Testing Library\n- **Coverage:** Vitest coverage\n- **E2E (optional):** Playwright (if time permits)\n\n## Test Organization\n\n```\nsrc/\n├── components/\n│   ├── shop/\n│   │   ├── FlavorRoster.tsx\n│   │   └── FlavorRoster.test.tsx        # Component tests\n│   └── ...\n├── engine/\n│   ├── encounterEngine.ts\n│   └── encounterEngine.test.ts         # Unit tests\n└── content/\n    ├── generators/\n    │   ├── encounterGenerator.ts\n    │   └── encounterGenerator.test.ts\n    └── ...\n```\n\n## Test Utilities\n\n```typescript\n// src/test-utils/testState.ts\nexport const mockGameState = (overrides?: Partial\u003cGameState\u003e): GameState =\u003e ({\n  day: 1,\n  phase: 'open-operation',\n  visible: {\n    popularity: 'medium',\n    meltOMeter: 'calm',\n    communitySupport: 'medium',\n    staffRoster: ['vanilla', 'chocolate', 'strawberry', 'butter-pecan', 'pistachio', 'cotton-candy'],\n    featuredFlavor: 'strawberry',\n  },\n  hidden: {\n    visibility: 10,\n    workerRiskProfiles: { vanilla: 20, chocolate: 15, /* ... */ },\n    customerArchetypeDrift: { regular: 0.8, nervous: 0.2 },\n    agentAggressionProfile: 'polite',\n    documentationQuality: 'sloppy',\n    legitimacyThresholds: { protest: false, defense: false },\n  },\n  ...overrides,\n});\n\nexport const mockWorkers = {\n  vanilla: { id: 'vanilla', name: 'Vanilla', status: 'present', symbolicWeight: 3 },\n  // ...\n};\n```\n\n## Component Testing Pattern\n\n```typescript\n// src/components/shop/FlavorRoster.test.tsx\nimport { render, screen, fireEvent } from '@testing-library/react';\nimport { FlavorRoster } from './FlavorRoster';\nimport { mockGameState, mockWorkers } from '@/test-utils/testState';\n\ndescribe('FlavorRoster', () =\u003e {\n  it('renders all workers when present', () =\u003e {\n    const state = mockGameState();\n    const workers = Object.values(mockWorkers);\n    \n    render(\u003cFlavorRoster workers={workers} featuredFlavor=\"strawberry\" /\u003e);\n    \n    expect(screen.getByText('Vanilla')).toBeInTheDocument();\n    expect(screen.getByText('Strawberry★')).toBeInTheDocument();\n  });\n  \n  it('shows removed styling for gone workers', () =\u003e {\n    const workers = [\n      mockWorkers.vanilla,\n      { ...mockWorkers.chocolate, status: 'removed' as const },\n    ];\n    \n    render(\u003cFlavorRoster workers={workers} /\u003e);\n    \n    const chocolate = screen.getByText('Chocolate').closest('[data-worker=\"chocolate\"]');\n    expect(chocolate).toHaveClass('worker-gone');\n    expect(screen.getByText('GONE')).toBeInTheDocument();\n  });\n});\n```\n\n## Engine Testing Pattern\n\n```typescript\n// src/engine/encounterEngine.test.ts\nimport { describe, it, expect } from 'vitest';\nimport { resolveEncounter, createEncounter } from './encounterEngine';\nimport { mockGameState } from '@/test-utils/testState';\n\ndescribe('encounterEngine', () =\u003e {\n  it('correctly identifies incorrect documentation', () =\u003e {\n    const state = mockGameState({\n      hidden: { ...mockGameState().hidden, documentationQuality: 'sloppy' },\n    });\n    \n    const encounter = createEncounter('cotton-candy', state);\n    \n    expect(encounter.documentation.quality).toBe('incorrect');\n  });\n  \n  it('removes worker when player complies with correct paperwork', () =\u003e {\n    const state = mockGameState();\n    const encounter = createEncounter('pistachio', state);\n    encounter.documentation.quality = 'correct';\n    \n    const result = resolveEncounter(encounter, { choice: 'comply' }, state);\n    \n    expect(result.stateChanges.workersRemoved).toContain('pistachio');\n  });\n});\n```\n\n## Content Testing Pattern\n\n```typescript\n// src/content/generators/encounterGenerator.test.ts\nimport { describe, it, expect } from 'vitest';\nimport { generateEncounterDialogue } from './encounterGenerator';\n\ndescribe('encounterGenerator', () =\u003e {\n  it('generates more polite dialogue at higher pressure', () =\u003e {\n    const low = generateEncounterDialogue('declaration', 'calm', 'vanilla', 'sloppy');\n    const high = generateEncounterDialogue('declaration', 'critical', 'vanilla', 'correct');\n    \n    // Higher pressure should have MORE politeness markers\n    expect(countPolitenessMarkers(high.text)).toBeGreaterThan(countPolitenessMarkers(low.text));\n  });\n  \n  it('never generates threatening language', () =\u003e {\n    const pressures: HeatLevel[] = ['calm', 'watched', 'tense', 'critical'];\n    \n    pressures.forEach(pressure =\u003e {\n      const dialogue = generateEncounterDialogue('declaration', pressure, 'strawberry', 'correct');\n      expect(dialogue.text).not.toMatch(/threat|force|will|must|demand/i);\n    });\n  });\n});\n```\n\n## Test Scripts\n\n```json\n// package.json\n{\n  \"scripts\": {\n    \"test\": \"vitest\",\n    \"test:ui\": \"vitest --ui\",\n    \"test:coverage\": \"vitest --coverage\",\n    \"test:run\": \"vitest run\"\n  }\n}\n```\n\n## Acceptance Criteria\n- [ ] Test utilities created (`mockGameState`, `mockWorkers`)\n- [ ] Each engine file has corresponding `.test.ts`\n- [ ] Each component has corresponding `.test.tsx`\n- [ ] Coverage report shows \u003e80% coverage\n- [ ] Tests run in \u003c5 seconds\n- [ ] CI/CD configured to run tests on push\n\n## Dependencies\n**BLOCKS ON:** SETUP-Base (needs Vitest configured)\n\n## Notes\n- Can start in parallel with TYPES\n- Focus on testing state transitions, not rendering\n- Use `@testing-library/user-event` for interactions\n","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T19:33:59.106215-05:00","created_by":"mayor","updated_at":"2026-01-18T20:14:27.645456-05:00","closed_at":"2026-01-18T20:14:27.645456-05:00","close_reason":"Closed","labels":["testing"],"dependencies":[{"issue_id":"icecream-jho","depends_on_id":"icecream-9v3","type":"blocks","created_at":"2026-01-18T19:34:19.40735-05:00","created_by":"mayor"}]}
{"id":"icecream-ovg","title":"ICE Cream Project: Game Engine \u0026 State Management","description":"\n# Game Engine \u0026 State Management\n\n**Priority:** P1\n**Dependencies:** TYPE-Foundation (must have types first)\n\n## Overview\nBuild the core game engine that manages state, handles the daily loop, and powers the simulation. This is the \"brain\" of the game.\n\n## Architecture\nUsing **Zustand** for state management (simple, no boilerplate, great for games).\n\n## Store Structure\n\n### 1. Main Game Store\n```typescript\n// src/store/gameStore.ts\ninterface GameStore {\n  // State\n  gameState: GameState;\n  uiState: UIState;\n  \n  // Actions\n  startNewGame: () =\u003e void;\n  advanceDay: () =\u003e void;\n  processEncounter: (encounter: AgentEncounter, choice: PlayerChoice) =\u003e void;\n  modifyState: (changes: Partial\u003cVisibleState\u003e) =\u003e void;\n  saveGame: () =\u003e void;\n  loadGame: () =\u003e void;\n}\n```\n\n### 2. Queue Generation Engine\n```typescript\n// src/engine/queueGenerator.ts\nexport function generateDailyQueue(\n  state: GameState\n): (Customer | Agent)[] {\n  const customerCount = calculateCustomerCount(state.visible.popularity);\n  const agentCount = calculateAgentCount(state.visible.meltOMeter, state.hidden.visibility);\n  \n  return shuffleAndInterleave(customers, agents);\n}\n```\n\n### 3. Encounter Engine\n```typescript\n// src/engine/encounterEngine.ts\nexport function createEncounter(\n  targetWorker: WorkerId,\n  state: GameState\n): AgentEncounter {\n  return {\n    targetWorker,\n    documentation: generateDocumentation(state.hidden.documentationQuality),\n    aggressionProfile: state.hidden.agentAggressionProfile,\n    steps: generateEncounterSteps(state),\n  };\n}\n\nexport function resolveEncounter(\n  encounter: AgentEncounter,\n  choice: PlayerChoice,\n  state: GameState\n): ResolutionResult {\n  // Calculate outcome based on:\n  // - Documentation quality\n  // - Player choice\n  // - Community support level\n  // - Hidden state values\n}\n```\n\n### 4. Customer Interaction Engine\n```typescript\n// src/engine/customerEngine.ts\nexport function processCustomerInteraction(\n  customer: Customer,\n  action: 'serve' | 'petition' | 'decline',\n  state: GameState\n): StateChanges {\n  // Returns changes to:\n  // - Popularity (may increase/decrease)\n  // - Community Support (petition increases)\n  // - Customer archetype (may drift)\n}\n```\n\n### 5. Protest Engine\n```typescript\n// src/engine/protestEngine.ts\nexport function calculateProtestOutcome(\n  workers: WorkerId[],\n  state: GameState\n): ProtestOutcome {\n  // Probabilistic outcome based on:\n  // - Melt-O-Meter level\n  // - Visibility\n  // - Workers' symbolic weights\n  // - Current Community Support\n}\n```\n\n### 6. Petition Recovery Engine\n```typescript\n// src/engine/recoveryEngine.ts\nexport function handlePlayerCapture(state: GameState): RecoveryState {\n  // Calculate signature requirements based on:\n  // - Past customer interactions\n  // - Community archetype drift\n  // - Prior agent encounters\n  \n  return {\n    signaturesRequired: 5,\n    availableContacts: getEncounteredCommunityMembers(state),\n    signatureProbabilities: calculateSignatureProbabilities(state),\n  };\n}\n```\n\n### 7. Phase Progression Engine\n```typescript\n// src/engine/phaseEngine.ts\nexport function calculatePhase(state: GameState): GamePhase {\n  // Phase transitions based on:\n  // - Days elapsed\n  // - Workers removed\n  // - Visibility level\n  // - Encounter history\n}\n```\n\n### 8. Simulation Engine (Full Game Play)\n```typescript\n// src/engine/simulator.ts\nexport function simulateGame(\n  config?: SimulationConfig,\n  seed?: number\n): SimulationResult {\n  // Runs entire game from start to finish\n  // Useful for:\n  // - Testing balance\n  // - Generating playthrough data\n  // - AI training\n  \n  let state = getInitialState();\n  const history: GameStateSnapshot[] = [state];\n  \n  while (state.phase !== 'ended') {\n    state = simulateDay(state);\n    history.push(state);\n  }\n  \n  return { history, finalState: state };\n}\n```\n\n## File Structure\n```\nsrc/\n├── store/\n│   ├── gameStore.ts          # Main Zustand store\n│   └── selectors.ts          # Derived state selectors\n├── engine/\n│   ├── queueGenerator.ts     # Daily queue generation\n│   ├── encounterEngine.ts    # Agent encounter logic\n│   ├── customerEngine.ts     # Customer interactions\n│   ├── protestEngine.ts      # Protest mechanics\n│   ├── recoveryEngine.ts     # Petition recovery mode\n│   ├── phaseEngine.ts        # Phase progression\n│   ├── simulator.ts          # Full game simulation\n│   └── stateUtils.ts         # State mutation helpers\n└── hooks/\n    ├── useGameState.ts       # Convenience hook\n    ├── useQueue.ts           # Queue management\n    └── useEncounter.ts       # Encounter state\n```\n\n## Core Mechanics to Implement\n\n### Queue Generation\n- Customer count from Popularity × Staffing\n- Agent count from Melt-O-Meter × Visibility\n- Only first 3 entities visible\n- Queue reveals as interactions complete\n\n### Encounter Resolution\n- Documentation check (hidden roll)\n- Player choice effects\n- State mutations (roster, support, melt-o-meter)\n- Documentation quality improvement (system adapts)\n\n### State Transitions\n```typescript\ntype StateTransition = {\n  from: GameState;\n  action: PlayerAction;\n  to: GameState;\n  visibleChanges: VisibleStateChange[];\n  hiddenChanges: HiddenStateChange[];\n};\n```\n\n## Testing Requirements\n- [ ] Queue generation produces valid distributions\n- [ ] Encounter resolution is deterministic with seed\n- [ ] All state paths are testable\n- [ ] Simulator can run 1000+ games in \u003c10 seconds\n\n## Acceptance Criteria\n- [ ] Zustand store created with all state\n- [ ] Queue generator produces valid daily queues\n- [ ] Encounter engine resolves all choice paths\n- [ ] Customer interactions modify state correctly\n- [ ] Protest outcomes are probabilistic but balanced\n- [ ] Simulator can run full games unattended\n- [ ] Save/load persists to localStorage\n- [ ] All engines have unit tests\n\n## Dependencies\n**BLOCKS ON:** TYPE-Foundation (types must exist)\n\n## Notes\n- Use Zustand's `persist` middleware for save/load\n- Consider Immer for immutable state updates\n- Simulator should accept a seed for reproducible tests\n","status":"closed","priority":1,"issue_type":"feature","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T19:33:25.044888-05:00","created_by":"mayor","updated_at":"2026-01-18T20:14:27.64409-05:00","closed_at":"2026-01-18T20:14:27.64409-05:00","close_reason":"Closed","labels":["engine","state"],"dependencies":[{"issue_id":"icecream-ovg","depends_on_id":"icecream-86x","type":"blocks","created_at":"2026-01-18T19:34:19.001214-05:00","created_by":"mayor"}]}
{"id":"icecream-p13","title":"Integrate Tone Guide into AGENTS.md","description":"Add TONE_AND_LANGUAGE_GUIDE.md reference to AGENTS.md so all content-generating agents follow consistent voice. Update CLAUDE.md if needed.","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-14T23:33:51.167105-05:00","created_by":"JB","updated_at":"2026-01-16T00:23:15.064584-05:00","closed_at":"2026-01-16T00:23:15.064584-05:00","close_reason":"Integrated TONE_AND_LANGUAGE_GUIDE.md reference into AGENTS.md and CLAUDE.md","dependencies":[{"issue_id":"icecream-p13","depends_on_id":"icecream-rz3","type":"blocks","created_at":"2026-01-14T23:34:22.824148-05:00","created_by":"JB"}]}
{"id":"icecream-qbe","title":"Content System (Encounter Grammars)","description":"ICE Cream: Encounter grammar templates, procedural generation.","status":"open","priority":1,"issue_type":"feature","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T20:29:06.154727-05:00","created_by":"mayor","updated_at":"2026-01-18T20:29:06.154727-05:00","labels":["content","procedural"]}
{"id":"icecream-rz3","title":"Create Tone \u0026 Language Guide","description":"Create TONE_AND_LANGUAGE_GUIDE.md defining how UI copy, dialogue, event descriptions, and satire should sound. Key principles: satire punches up at systems/bureaucracy/power (never victims), educational not instructional, opacity by design. Should cover: UI microcopy tone, event description voice, satirical framing guidelines, what to avoid. Output becomes reference for all content generation.","status":"closed","priority":1,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-14T23:33:30.430781-05:00","created_by":"JB","updated_at":"2026-01-16T00:18:41.873828-05:00","closed_at":"2026-01-16T00:18:41.873828-05:00","close_reason":"Created TONE_AND_LANGUAGE_GUIDE.md covering: UI microcopy tone (bureaucratic, dry), event description voice (documentary neutral), dialogue guidelines (natural, fragmented), satirical framing (deadpan absurdist), and what to avoid. Includes reference checklist for content validation."}
{"id":"icecream-t9r","title":"ICE Cream Project: Content System (Encounter Grammars)","description":"\n# Content System (Encounter Grammars \u0026 Templates)\n\n**Priority:** P1\n**Dependencies:** TYPE-Foundation\n\n## Overview\nBuild the content system that generates agent dialogue, encounter variations, and customer interactions using grammars and templates rather than hand-written scripts.\n\n## Content Architecture\n\n### 1. Encounter Grammars\n```typescript\n// src/content/grammars/encounterGrammar.ts\n\ninterface EncounterGrammar {\n  phases: {\n    declaration: PhraseTemplate[];\n    engagement: PhraseTemplate[];\n    documentation: PhraseTemplate[];\n    resolution: ResolutionTemplate[];\n  };\n  toneModifiers: ToneModifier[];\n}\n\ninterface PhraseTemplate {\n  template: string;\n  variables: Record\u003cstring, VariableOption[]\u003e;\n  conditions?: TemplateCondition[];\n}\n\ntype ToneModifier = {\n  pressureLevel: HeatLevel;\n  modifiers: string[];\n  // Higher pressure = MORE politeness (escalation rule)\n};\n```\n\n### 2. Agent Dialogue Templates\n\n#### Declaration Phase\n```typescript\nconst declarationTemplates = {\n  low: [\n    \"Good afternoon\\! I do hope we're not catching you at an inconvenient moment.\",\n    \"We're just here to sort out a small administrative curiosity.\",\n    \"Excuse me, madam. I do beg your pardon for the interruption.\",\n  ],\n  medium: [\n    \"Good afternoon\\! We do hope this lovely shop is having a prosperous day.\",\n    \"We're so pleased to see how well you're operating under what must be... challenging circumstances.\",\n    \"Thank you for your patience. We do appreciate a shop that values proper process.\",\n  ],\n  high: [\n    \"We've been so impressed by this shop's resilience. Truly. It's remarkable what you've managed here.\",\n    \"We've taken the liberty of preparing everything in advance. To minimize disruption. Doesn't that sound thoughtful?\",\n    \"Oh, how wonderful\\! A community gathering. We do so love to see civic engagement.\",\n  ],\n  critical: [\n    \"We've taken the liberty of making all the arrangements for you. Doesn't that take a weight off your mind?\",\n    \"Everything has been handled for your convenience. Duration and destination are already arranged.\",\n    \"We do want this to be as comfortable as possible for everyone. Yes. Take a moment. We'll wait.\",\n  ],\n};\n```\n\n#### Engagement Responses\n```typescript\nconst engagementResponses = {\n  askForPapers: {\n    low: \"Oh, how wonderfully organized\\! We do appreciate a shop that respects process.\",\n    medium: \"Of course. We were hoping you'd ask. Process is so important, isn't it?\",\n    high: \"Here we are. Complete and thorough. We do pride ourselves on our attention to detail.\",\n  },\n  hesitate: {\n    low: \"Oh dear. I think we may have explained this poorly.\",\n    medium: \"There's really no decision to be made.\",\n    high: \"Let's not make this more confusing than it needs to be.\",\n  },\n  assertRights: {\n    low: \"How very informed of you.\",\n    medium: \"We do admire initiative.\",\n    high: \"Unfortunately, this particular matter has progressed beyond discussion.\",\n  },\n};\n```\n\n### 3. Customer Interaction Templates\n\n#### Regular Customers\n```typescript\nconst customerTemplates = {\n  requestFlavor: [\n    \"Can I get {{flavor}} today?\",\n    \"I'll have {{flavor}}, please.\",\n    \"{{flavor}} sounds good.\",\n  ],\n  reactionToRemoval: {\n    vanilla: [\n      \"Where's Vanilla? It's not the same without it.\",\n      \"I used to come here for Vanilla...\",\n      \"Oh. No Vanilla today.\",\n    ],\n    chocolate: [\n      \"What happened to Chocolate?\",\n      \"My kids loved Chocolate...\",\n    ],\n  },\n  petitionResponse: {\n    willing: [\n      \"Sure, I'll sign.\",\n      \"Of course. Whatever helps.\",\n      \"Yeah, put me down.\",\n    ],\n    nervous: [\n      \"I... I don't know. Is it safe?\",\n      \"They're watching, aren't they?\",\n      \"Maybe not today.\",\n    ],\n    refusal: [\n      \"No, I shouldn't.\",\n      \"I better not.\",\n      \"Sorry, can't help.\",\n    ],\n  },\n};\n```\n\n### 4. Procedural Generation Engine\n\n```typescript\n// src/content/generators/encounterGenerator.ts\n\nexport function generateEncounterDialogue(\n  phase: 'declaration' | 'engagement' | 'resolution',\n  pressureLevel: HeatLevel,\n  workerId: WorkerId,\n  documentationQuality: DocumentationQuality\n): GeneratedDialogue {\n  const templates = encounterTemplates[phase][pressureLevel];\n  const template = selectTemplate(templates);\n  \n  return {\n    text: interpolateTemplate(template, { worker: workerId }),\n    tone: calculateTone(pressureLevel),\n    options: generateOptions(phase, documentationQuality),\n  };\n}\n```\n\n### 5. End-of-Day Summary Generator\n\n```typescript\n// src/content/generators/summaryGenerator.ts\n\ninterface DayEvents {\n  customersServed: number;\n  agentsEncountered: number;\n  workersRemoved: WorkerId[];\n  communityActions: CommunityAction[];\n}\n\nexport function generateDaySummary(events: DayEvents): string {\n  // Generate narrative based on day's events\n  // Use template fragments and combine them\n  \n  if (events.agentsEncountered === 0) {\n    return \"The shop was quiet today. No agents came. Customers noticed the calm, but some wondered when the next visit would come.\";\n  }\n  \n  if (events.workersRemoved.length \u003e 0) {\n    return generateRemovalSummary(events.workersRemoved);\n  }\n  \n  // ... more variations\n}\n```\n\n### 6. Petition Recovery Messages\n\n```typescript\n// src/content/generators/recoveryGenerator.ts\n\nexport function generateRecoveryMessages(\n  contacts: CommunityMember[],\n  state: GameState\n): RecoveryMessage[] {\n  return contacts.map(contact =\u003e ({\n    contact,\n    message: generatePersonalizedMessage(contact, state),\n    responseProbability: calculateResponseProbability(contact, state),\n    responseIfYes: generateAcceptanceMessage(contact),\n    responseIfNo: generateRejectionMessage(contact),\n  }));\n}\n```\n\n## Content Organization\n\n```\nsrc/content/\n├── grammars/\n│   ├── encounterGrammar.ts      # Agent dialogue templates\n│   ├── customerGrammar.ts        # Customer interaction templates\n│   ├── summaryGrammar.ts         # End-of-day summary templates\n│   └── recoveryGrammar.ts        # Petition recovery messages\n├── generators/\n│   ├── encounterGenerator.ts     # Procedural dialogue generation\n│   ├── customerGenerator.ts      # Customer interaction generation\n│   ├── summaryGenerator.ts       # Summary narrative generation\n│   └── recoveryGenerator.ts      # Recovery message generation\n├── data/\n│   ├── phrases.json              # Phrase database (could be external)\n│   └── templates.json            # Template database\n└── index.ts\n```\n\n## Content Principles (from TONE_AND_CONTENT.md)\n\n### Escalation Rule\n- **Low pressure:** Polite, neutral, informational\n- **Medium pressure:** Warmer, more apologetic, more reassuring\n- **High pressure:** Excessively gracious, almost celebratory, completely non-specific\n- **Critical:** Maximum politeness, absolute confidence in consent\n\n### Never Target\n- Workers (flavors)\n- Victims\n- Fear or grief\n\n### Always Target\n- Bureaucracy\n- Euphemism\n- Procedural absurdity\n- System that never admits fault\n\n## Acceptance Criteria\n- [ ] Encounter grammar generates all 3 encounter examples from docs\n- [ ] Customer grammar produces varied dialogue\n- [ ] Summary generator creates narratives for all day types\n- [ ] Recovery messages reference past interactions\n- [ ] All generated dialogue follows tone governance\n- [ ] No hardcoded dialogue strings in components\n- [ ] Grammar is extensible (add new phrases without code changes)\n\n## Dependencies\n**BLOCKS ON:** TYPE-Foundation\n\n## Notes\n- Consider storing phrase database in JSON for easy editing\n- Could expose to non-technical team members\n- Grammar system should be testable independently\n","status":"closed","priority":1,"issue_type":"feature","owner":"jonathan@awellhealth.com","created_at":"2026-01-18T19:33:25.581014-05:00","created_by":"mayor","updated_at":"2026-01-18T20:14:27.642696-05:00","closed_at":"2026-01-18T20:14:27.642696-05:00","close_reason":"Closed","labels":["content","procedural"],"dependencies":[{"issue_id":"icecream-t9r","depends_on_id":"icecream-86x","type":"blocks","created_at":"2026-01-18T19:34:19.30611-05:00","created_by":"mayor"}]}
{"id":"icecream-th2","title":"Create NGO Support/Donate page","description":"Design page linking to NGOs providing legal support to those targeted by ICE. Research and curate list of reputable organizations (RAICES, ACLU Immigrants Rights, National Immigration Law Center, local legal aid orgs). Include brief descriptions and direct donation links. Consider recurring donation options.","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-14T23:33:51.597855-05:00","created_by":"JB","updated_at":"2026-01-14T23:37:30.612747-05:00","closed_at":"2026-01-14T23:37:30.612747-05:00","close_reason":"Created /support and /resources pages with NGO links and Know Your Rights resources"}
{"id":"icecream-tnq","title":"Create Ethical Disclaimer page","description":"Write clear disclaimer separating gameplay abstraction from real-world advice. Cover: this is not legal advice, not a how-to guide, fictionalized events based on historical precedent, consult actual legal resources for real situations. Follow tone guide.","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-14T23:33:51.803642-05:00","created_by":"JB","updated_at":"2026-01-16T00:25:33.330212-05:00","closed_at":"2026-01-16T00:25:33.330212-05:00","close_reason":"Created Ethical Disclaimer page with legal disclaimer, fictional nature explanation, and content advisory","dependencies":[{"issue_id":"icecream-tnq","depends_on_id":"icecream-rz3","type":"blocks","created_at":"2026-01-14T23:34:23.161942-05:00","created_by":"JB"}]}
{"id":"icecream-uf7","title":"Set up Vitest testing infrastructure","description":"## Deliverable\nSet up Vitest with React Testing Library for component and page testing.\n\n## Files to Create\n- vitest.config.ts\n- src/test/setup.ts (test setup with RTL)\n\n## Files to Modify\n- package.json (add test scripts and dependencies)\n\n## Complexity: Small\n\n## Dependencies to Install\n- vitest\n- @vitejs/plugin-react\n- @testing-library/react\n- @testing-library/jest-dom\n- jsdom\n\n## Implementation Details\n- Configure Vitest for Next.js App Router\n- Set up React Testing Library\n- Add 'test' and 'test:watch' scripts to package.json\n- Configure path aliases to match tsconfig\n\n## Acceptance Criteria\n- pnpm test runs successfully (even with no tests)\n- Vitest configured for React/JSX\n- Testing Library available for component tests\n- Path aliases (@/) work in tests","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-16T00:08:15.466302-05:00","created_by":"JB","updated_at":"2026-01-16T00:28:35.415618-05:00","closed_at":"2026-01-16T00:28:35.415618-05:00","close_reason":"Set up Vitest with React Testing Library, jsdom, and path aliases","dependencies":[{"issue_id":"icecream-uf7","depends_on_id":"icecream-xaj","type":"blocks","created_at":"2026-01-16T00:08:45.893839-05:00","created_by":"JB"}]}
{"id":"icecream-xaj","title":"Create dashboard directory structure","description":"## Deliverable\nCreate the Next.js app router directory structure for the dashboard feature.\n\n## Files to Create\n- src/app/dashboard/page.tsx (placeholder)\n- src/app/dashboard/cities/[id]/page.tsx (placeholder)\n\n## Complexity: Small\n\n## Acceptance Criteria\n- Directory structure exists\n- Placeholder files export valid React components\n- No TypeScript errors","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-16T00:04:14.497245-05:00","created_by":"JB","updated_at":"2026-01-16T00:23:15.423726-05:00","closed_at":"2026-01-16T00:23:15.423726-05:00","close_reason":"Created dashboard directory structure with placeholder pages"}
{"id":"icecream-xvv","title":"Write dashboard page tests","description":"## Deliverable\nTests for the /dashboard cities list page.\n\n## Files to Create\n- src/app/dashboard/page.test.tsx\n\n## Complexity: Medium\n\n## Test Cases\n1. Renders page title/heading\n2. Displays city cards when data loads successfully\n3. Each city card shows name, state, and pulse bars\n4. City cards link to correct detail page (/dashboard/cities/[id])\n5. Handles empty state (no cities)\n6. Handles error state (fetch failure)\n\n## Dependencies\n- Requires test infrastructure (icecream-uf7)\n- Requires dashboard page (icecream-2w5)\n\n## Mocking Required\n- Mock getCities() from content service\n- Provide sample city data fixtures\n\n## Acceptance Criteria\n- All test cases pass\n- Content service properly mocked\n- Tests verify correct data rendering","status":"closed","priority":2,"issue_type":"task","owner":"jonathan@awellhealth.com","created_at":"2026-01-16T00:08:30.853441-05:00","created_by":"JB","updated_at":"2026-01-16T00:30:13.006177-05:00","closed_at":"2026-01-16T00:30:13.006177-05:00","close_reason":"Added 7 tests for dashboard page with mocked content service","dependencies":[{"issue_id":"icecream-xvv","depends_on_id":"icecream-uf7","type":"blocks","created_at":"2026-01-16T00:08:46.230294-05:00","created_by":"JB"},{"issue_id":"icecream-xvv","depends_on_id":"icecream-2w5","type":"blocks","created_at":"2026-01-16T00:08:46.340781-05:00","created_by":"JB"}]}
